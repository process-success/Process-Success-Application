!function(){frappe.provide("ps"),frappe.provide("ps.frappe");ps.init_ui=function(){},ps.alert={},ps.alert.config={fadeIn:200,fadeOut:600,showFor:2e3},ps.successAlert=function(e){$(".success-text").html(" "+e);var t=$("#alerts .alert-success");t.fadeIn(ps.alert.config.fadeIn),setTimeout(function(){t.fadeOut(ps.alert.config.fadeOut)},ps.alert.config.showFor)},ps.failAlert=function(e){$(".fail-text").html(" "+e);var t=$("#alerts .alert-danger");t.fadeIn(ps.alert.config.fadeIn),setTimeout(function(){t.fadeOut(ps.alert.config.fadeOut)},ps.alert.config.showFor)},ps.set_handlers=function(e,t){var o=function(e,t){return function(o,n){o.responseJSON&&(n=o.responseJSON);var r=e;n._server_messages&&(r=($.map(JSON.parse(n._server_messages||"[]"),function(e){console.log(e);try{return JSON.parse(e).message}catch(t){return e}})||[]).join("<br>")||e),console.log(r),void 0!==t&&t()}};return{200:function(t){e(t)},401:o(__("error"),t),417:o(__("error"),t),404:o(__("error"),t),400:o(__("error"),t)}},ps.call=function(e,t,o){return frappe.call({type:"POST",args:e,freeze:!0,statusCode:ps.set_handlers(t,o)})},ps.escapeAttr=function(e){return e.replace(/(:|\.|\[|\]|,|=|@)/g,"\\$1")},ps.am_to_numeric=function(e){var t="",o=e.split(":"),n=o[1].split("A");if(1==n.length){var r=o[1].split("P");t=(parseInt(o[0])+12).toString()+":"+r[0]+":00"}else t=o[0]+":"+n[0]+":00";return t},ps.time_add_digits=function(e){var t=e.split(":");return 2==t.length?t[0]+":"+t[1]+":00":e},ps.time_add_front_zero=function(e){if(void 0!==e){for(var t=e.split(":"),o="",n=0;n<t.length;n++){var r=t[n];1==r.length&&(r="0"+r),o+=0==n?r:":"+r}return o}},ps.frappe.isready=0}(),frappe.ready(function(){ps.init_ui(),ps.frappe.isready=1}),ps.get_host=function(){var e=window.location.origin,t=e.split(":"),o=frappe.boot.socketio_port||"8000";return t.length>=2&&(e=t[1]),window.dev_server&&(e=e+":"+o),e},ps.hostReachable=function(){var e=new(window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");e.open("HEAD","//"+ps.get_host()+"/test.html",!1);try{return e.send(),e.status>=200&&(e.status<300||304===e.status)}catch(e){return!1}},ps.online=ps.hostReachable(),ps.socket={open_tasks:{},open_docs:[],init:function(){if(!ps.socket.socket){if("https:"==window.location.protocol?ps.socket.socket=io.connect(ps.socket.get_host(),{secure:!0}):"http:"==window.location.protocol&&(ps.socket.socket=io.connect(ps.socket.get_host())),!ps.socket.socket)return void console.log("Unable to connect to "+ps.socket.get_host());ps.socket.socket.on("msgprint",function(e){frappe.msgprint(e)}),ps.socket.socket.on("reconnect",function(e){frappe.msgprint("reconnected"),ps.online=!0}),ps.socket.socket.on("connect",function(e){ps.online=!0}),ps.socket.socket.on("disconnect",function(e){frappe.msgprint("disconnect"),ps.online=!1})}},get_host:function(){var e=window.location.origin;if(window.dev_server){var t=e.split(":"),o=frappe.boot.socketio_port||"9000";t.length>2&&(e=t[0]+":"+t[1]),e=e+":"+o}return e},subscribe:function(e,t){},process_response:function(e,t){}},ps.socket.init(),frappe.ready(function(){}),frappe.provide("ps.storage"),ps.storage={ident:"pstimed",generateKey:function(e,t){var o=(new Date).getTime()+60*t*60*1e3;return this.ident+"?"+o+"?"+md5(JSON.stringify(e))},garbageCollect:function(){var e=[];if(localStorage.length>0)for(var t=0;t<localStorage.length;t++){var o=localStorage.key(t),n=o.split("?");if(3==n.length){var r=n[1];r<(new Date).getTime()&&e.push(o)}}if(e.length>0)for(var s=0;s<e.length;s++)localStorage.removeItem(e[s])},store:function(e,t,o){void 0===o&&(o=30);for(var n=this.generateKey(e,o),r=md5(JSON.stringify(e)),s=[],i=0;i<localStorage.length;i++){var a=localStorage.key(i),c=a.split("?");if(3==c.length){var p=c[2];c[0]==this.ident&&p==r&&s.push(a)}}if(s.length>0)for(var u=0;u<s.length;u++)localStorage.removeItem(s[u]);this.garbageCollect(),localStorage.setItem(n,JSON.stringify(t))},get:function(e){for(var t=md5(JSON.stringify(e)),o=0;o<localStorage.length;o++){var n=localStorage.key(o),r=n.split("?");if(3==r.length){var s=r[2];if(r[0]==this.ident&&s==t){var i=localStorage.getItem(n);return"undefined"==i?0:JSON.parse(i)}}}},remove:function(e){for(var t=md5(JSON.stringify(e)),o=0;o<localStorage.length;o++){var n=localStorage.key(o),r=n.split("?");if(3==r.length){var s=r[2];r[0]==this.ident&&s==t&&localStorage.removeItem(n)}}}},function(){frappe.provide("ps.obj"),ps.obj.init=function(){function e(e,t,o){return function(n){var r=i.get_index_of_item(n.name);i.items[r]=n,i.rendermode&&(i.derender(n),i.rerender(n,e,t,o)),i.renderHook()}}function t(){return function(e){console.log("react emmit",e);var t=i.get_index_of_item(e.name);i.items[t]=e,i.renderHook()}}function o(e,t,o){ps.call(i.args,function(e){n(i.args,e.message),console.log("_________ps.obj From Server call_______________"),console.log(i.args,e.message),console.log("-----------------------------------------------"),void 0!==t&&t(e.message)},function(){console.log("call fail callback"),void 0!==t&&o()})}function n(e,t){i.items=t,i.sort(),ps.storage.store(e,t)}function r(){ps.storage.store(i.args,i.items)}function s(e,t){var o=ps.storage.get(i.args);void 0===o?console.log("Get local failed"):n(e,o),void 0!==t&&t()}var i={};return i.get_function="",i.update_function="",i.doctype="",i.items=[],i.id="",i.args={},i.hasUpdates=0,i.renderHook=function(){},i.rendermode=0,i.get=function(e,t,n){return void 0===e&&(e={}),i.args=e,i.args.cmd=i.get_function,i.id=md5(JSON.stringify(i.args)),s(i.args),console.log("ONLINE"+ps.online),ps.online?ps.frappe.isready?i.updateQue(function(){o(i.args,t,n)}):frappe.ready(function(){i.updateQue(function(){o(i.args,t,n)})}):s(i.args,t),i.items},i.update=function(e,t,o){r();var n={};n.cmd=i.update_function,n.item=e,ps.online?ps.call(n,function(n){if(void 0!==o&&1==o){i.get_index_of_item(e.name);console.log(n),ps.socket.socket.emit("update_item",{doctype:i.doctype,item:n.message})}else ps.socket.socket.emit("update_item",{doctype:i.doctype,item:e});void 0!==t&&t(n.message)}):i.addUpdateQue(e)},i.changed=function(e){ps.socket.socket.emit("update_item",{doctype:i.doctype,item:e})},i.addUpdateQue=function(e){var t=ps.storage.get(i.id+"que");if(void 0!==t){for(var o=1,n=0;n<t.length;n++)t[n]==e.name&&(o=0);o&&t.push(e.name)}else t=[e.name];ps.storage.store(i.id+"que",t),i.hasUpdates=1},i.updateQue=function(e){var t=ps.storage.get(i.id+"que");if(ps.online)if(void 0!==t)for(var o=0;o<t.length;o++){var n=t[o],r=0;o==t.length-1&&(r=1),i.update(i.get_item(n),function(t,o){return function(){var n=ps.storage.get(i.id+"que"),r=n.indexOf(t);n.splice(r,1),0===n.length?ps.storage.remove(i.id+"que"):ps.storage.store(i.id+"que",n),o&&e()}}(n,r))}else e()},i.reactSetup=function(e){if(i.renderHook=e,void 0===i.items);else for(var o=0;o<i.items.length;o++){var n=i.items[o];console.log(i.doctype+"_"+n.name),ps.socket.socket.on("update_"+i.doctype+"_"+n.name,t())}},i.render=function(t,o,n,r){i.rendermode=1,$(frappe.render_template(o,t)).appendTo(n),r(t.name),ps.socket.socket.on("update_"+i.doctype+"_"+t.name,e(o,n,r))},i.rerender=function(e,t,o,n){$(frappe.render_template(t,e)).appendTo(o),n(e.name,i)},i.derender=function(e){$("#"+e.name).remove()},i.get_index_of_item=function(e){for(var t=0;t<i.items.length;t++)if(e==i.items[t].name)return t},i.get_item=function(e){for(var t=0;t<i.items.length;t++)if(e==i.items[t].name)return i.items[t]},i.sort=function(){void 0!==i.items&&void 0!==i.items[0]&&(void 0===i.items[0].priority||i.items.sort(function(e,t){return e.priority-t.priority}))},ps.socket.socket.on("reconnect",function(){location.reload()}),i}}(),frappe.provide("ps"),ps.initWorkorder=function(){var e=ps.obj.init();return e.doctype="work_orders",e.get_function="process_success.time_tracking.doctype.work_order.work_order.get_workorders",e.update_function="process_success.time_tracking.doctype.work_order.work_order.update_workorder",e},ps.initCurrentUser=function(){var e=ps.obj.init();return e.doctype="Employee",e.get_function="process_success.ps_core.api.get_current_users_info",e.update_function="",e},ps.initTimeSheets=function(){var e=ps.obj.init();return e.doctype="Time_Sheet",e.get_function="process_success.time_tracking.doctype.time_sheet.time_sheet.get_make_days_timesheets",e.update_function="process_success.time_tracking.doctype.time_sheet.time_sheet.update_timesheet",e.add_employee_to_sheet="",e},ps.initEmployeeList=function(){var e=ps.obj.init();return e.doctype="Employee",e.get_function="process_success.ps_core.api.get_all_employees",e.update_function="",e},ps.initGeneral=function(){};