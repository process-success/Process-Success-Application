{"version":3,"sources":["ps.storage.js"],"names":["frappe","provide","ps","storage","ident","generateKey","args","time","expire","Date","getTime","key","md5","JSON","stringify","garbageCollect","removeKeys","localStorage","length","i","keyarray","split","push","y","removeItem","store","value","saveKey","checkhash","remove","hash","thehash","setItem","get","searchfor","parse","getItem"],"mappings":"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","file":"ps.storage.js","sourcesContent":["frappe.provide(\"ps.storage\");\n\n/*\n\tLOCAL STORAGE TOOL\n\ttakes a object/JSON and turns it to a ID\n\tuses that json as a key\n\tadds an expiration to the item\n\tgarbageCollect : garbage collects\n*/\nps.storage={\n\tident:\"pstimed\",\n\tgenerateKey:function(args,time){\n\t\tvar expire = new Date().getTime()+(time * 60 * 60 * 1000);\n\t\tvar key = this.ident+\"?\"+expire+\"?\"+md5(JSON.stringify(args));\n\t\treturn key;\n\t},\n\tgarbageCollect:function(){\n\t\tvar removeKeys=[];\n\t\tif(localStorage.length>0){\n\t\t\tfor (var i = 0; i < localStorage.length; i++){\n    \t\t\tvar key=localStorage.key(i);\n    \t\t\tvar keyarray=key.split(\"?\");\n    \t\t\tif (keyarray.length==3){\n    \t\t\t\tvar time=keyarray[1];\n    \t\t\t\tif(time < new Date().getTime()){\n    \t\t\t\t\tremoveKeys.push(key);\n    \t\t\t\t}\n    \t\t\t}\n\n\t\t\t}\n\t\t}\n\t\tif(removeKeys.length>0){\n\t\t\tfor(var y = 0; y < removeKeys.length; y++){\n\t\t\t\tlocalStorage.removeItem(removeKeys[y]);\n\t\t\t}\n\t\t}\n\t},\n\tstore:function(args,value,time){\n\t\tif(typeof(time)==\"undefined\"){time=30;}\n\t\tvar saveKey = this.generateKey(args,time);\n\t\tvar checkhash=md5(JSON.stringify(args));\n\t\tvar remove=[];\n\t\tfor (var i = 0; i < localStorage.length; i++){\n\t\t\tvar key=localStorage.key(i);\n\t\t\tvar hash=key.split(\"?\");\n\t\t\tif (hash.length==3){\n\t\t\t\tvar thehash=hash[2];\n\t\t\t\tif ( hash[0]==this.ident&& thehash==checkhash){\n\t\t\t\t\tremove.push(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif(remove.length>0){\n\t\t\tfor(var y = 0; y < remove.length; y++){\n\t\t\t\tlocalStorage.removeItem(remove[y]);\n\t\t\t}\n\t\t}\n\t\tthis.garbageCollect();\n\t\tlocalStorage.setItem(saveKey,JSON.stringify(value));\n\n\t},\n\tget:function(args){\n\t\tvar searchfor=md5(JSON.stringify(args));\n\t\tfor (var i = 0; i < localStorage.length; i++){\n\t\t\tvar key=localStorage.key(i);\n\t\t\tvar hash=key.split(\"?\");\n\t\t\tif (hash.length==3){\n\t\t\t\tvar thehash=hash[2];\n\t\t\t\tif ( hash[0]==this.ident&& thehash==searchfor){\n\t\t\t\t\treturn JSON.parse(localStorage.getItem(key));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\tremove:function(args){\n\t\tvar searchfor=md5(JSON.stringify(args));\n\t\tfor (var i = 0; i < localStorage.length; i++){\n\t\t\tvar key=localStorage.key(i);\n\t\t\tvar hash=key.split(\"?\");\n\t\t\tif (hash.length==3){\n\t\t\t\tvar thehash=hash[2];\n\t\t\t\tif ( hash[0]==this.ident&& thehash==searchfor){\n\t\t\t\t\tlocalStorage.removeItem(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n};"]}